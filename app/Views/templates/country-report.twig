<div class="wrap">
    <h1>{{ page_title }}</h1>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    {% include 'report-styles.twig' %}

    <div class="postbox">
        <div class="inside">
            {% if data %}
                <div class="chart-container">
                    <canvas id="countryChart"></canvas>
                </div>
                <table class="wp-list-table widefat striped">
                    <thead>
                        <tr>
                            <th>Country</th>
                            <th>Count</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for country in data %}
                            <tr>
                                <td>{{ country.home_country }}</td>
                                <td><strong>{{ country.count }}</strong></td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No international student data available.</p>
            {% endif %}
        </div>
    </div>
</div>

<script>
{% if data %}
new Chart(document.getElementById('countryChart'), {
    type: 'pie',
    data: {
        labels: [{% for country in data %}'{{ country.home_country }}'{% if not loop.last %},{% endif %}{% endfor %}],
        datasets: [{
            data: [{% for country in data %}{{ country.count }}{% if not loop.last %},{% endif %}{% endfor %}],
            backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40', '#C9CBCF', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9', '#F8C471', '#82E0AA', '#F1948A']
        }]
    },
    options: { responsive: true, maintainAspectRatio: false }
});
{% endif %}
</script>